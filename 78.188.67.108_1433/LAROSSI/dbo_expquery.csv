inx,Modul,Tip,Sorgu,Sure,insDT,insUser
1,Pazarlama Analiz ve Sipariş Yönetimi ...,sql,"if OBJECT_ID('tempdb.dbo.#BE25E87FF65D4ADC9ACC490D65AA72B2') IS NOT NULL DROP TABLE #BE25E87FF65D4ADC9ACC490D65AA72B2 CREATE TABLE #BE25E87FF65D4ADC9ACC490D65AA72B2 (  [CariKod] varchar (15) ,[CariKod_Tanim] varchar (250) ,[skod] varchar (15) ,[SKod_Tanim] varchar (50) ,[SipNo] int,[BelgeNo] varchar (50) ,[SipTanim] varchar (150) ,[LotNo] varchar (50) ,[RKod] int,[RKod_Tanim] varchar (50) ,[Asorti] varchar (5) ,[Siparis_Miktari] numeric(21,6) ,[Toplam_Kapatilan] numeric(21,6) ,[Gonderilen] numeric(21,6) ,[Faturalanan] numeric(21,6) ,[Satinalma_Top] numeric(21,6) ,[Satinalma_kalan] numeric(21,6)  ); insert INTO #BE25E87FF65D4ADC9ACC490D65AA72B2 select     k.CariKod , (case substring(k.SipTip,2,1) when 'D' then (Select LName From Location l Where l.location=k.CariKod) when 'T' then isnull((select top 1 Ad from st_firma_kart ff Where ff.fkod=k.CariKod),cr.CName) else cr.CName end)  as CariKod_Tanim,h.skod , st.Tanim as SKod_Tanim,k.SipNo,k.BelgeNo,h.tanim as SipTanim,h.LotNo as LotNo,si.RKod, rnk.Tanim   as RKod_Tanim,si.Asorti ,isNull(si.Miktar,0)  as Siparis_Miktari  , (case when (isnull(k.Durum,'')='*') or (isnull(h.Durum,'')='*') then  isnull(si.Miktar,0) else isnull(si.Closed,0)  end) as Toplam_Kapatilan   , isnull((select sum(isnull(sgc.Miktar,0)) From (fatura_kay mfat join Fatura_Har fat on mfat.BelgeNo=fat.BelgeNo)  Left Outer join K_FisAsortiList sgc on (sgc.Modul='F') and  (fat.BelgeNo=sgc.FisNo)and(fat.FatHarinx=sgc.FisHarinx) and (sgc.rkod=si.rkod)and(sgc.Asorti=si.Asorti)  Where (fat.SipHarinx=h.SipHarinx)  ),0) as Gonderilen  , isnull((select sum(isnull(sgc.Miktar,0)) From (fatura_kay mfat join Fatura_Har fat on mfat.BelgeNo=fat.BelgeNo)  Left Outer join K_FisAsortiList sgc on  (sgc.Modul='F') and (fat.BelgeNo=sgc.FisNo)and(fat.FatHarinx=sgc.FisHarinx) and (sgc.rkod=si.rkod)and(sgc.Asorti=si.Asorti)  Where (fat.SipHarinx=h.SipHarinx) and ((mfat.fatura='*')or(exists(select top 1 irsNo From fatirs Where (irsNo=mfat.BelgeNo) ) )) ),0) as Faturalanan , isnull(dbo.kg_fn_GetStokSipX(h.skod  , si.rkod  , Null ,'A', 'L001' ,Null,Null,'',Null,Null  ,Null,Null, si.asorti,'A',isnull(h.sipharinx,0)  ,h.LotNo) ,0) as Satinalma_Top , isnull(dbo.kg_fn_GetStokSipX(h.skod  , si.rkod  , Null ,'A', 'L001' ,Null,Null,'*',Null,Null  ,Null,Null, si.asorti,'A',isnull(h.sipharinx,0)  ,h.LotNo) ,0) + isnull(dbo.kg_fn_GetStokSipX(h.skod  , si.rkod  , Null ,'AD', 'L001' ,Null,Null,'*',Null,Null  ,Null,Null, si.asorti,'A',h.sipharinx  ,h.LotNo) ,0) as Satinalma_kalan  From Siparis_Kay k Join Siparis_Har h on k.SipNo=h.SipNo  left join siparistutar tutar on tutar.FisNo = h.SipNo and tutar.FisHarinx = h.SipHarinx and tutar.ParaCinsi='US' and tutar.LineType='S'  join K_SipAsortiList si on (si.FisNo=h.SipNo)and(si.FisHarinx=h.SipHarinx)and(si.SKod=h.SKod)  Left Outer Join Korgun_Parameter.Dbo.P_RNK_Tip rnk On (rnk.Renk_kod=si.Rkod)   Left Outer Join StokKart st on (st.Skod=h.skod)  Left Outer Join Cari_Kart cr on (cr.CKod=k.CariKod)  Left Outer Join Cari_Adres ca on (ca.Ckod=k.CariKod and ca.AdresTanim=k.AdresAdi)  Where  (isNull(cr.Pasif, '')='')  AND  (isNull(cr.KaraListe, '')='')  AND  (k.Location in ('L001'))  AND  ((k.Durum='')or(k.Durum is Null)) and ((h.Durum='')or(h.durum is null))  AND  ( (k.SipTip = 'S') or (k.SipTip = 'SD'))  AND  (h.skod in (Select stk.skod From StokKart stk join CoLoSo c on stk.skod=c.skod  Where  (isNull(stk.Pasif, '') = '') )) Select * into ##A22D1ACC4A994FD79EFC867C466E03BB from (Select cariKod, CariKod_Tanim,SKod, SKod_Tanim,SipNo ,BelgeNo ,SipTanim ,LotNo ,RKod,RKod_Tanim,Asorti , (select top 1 Tanim From Korgun_Parameter.Dbo.P_Kol_Tip_M Bed Where Bed.Koli_Kod=Asorti collate turkish_ci_as) as Asorti_Tanim  ,(select top 1 Tanim2 From Korgun_Parameter.Dbo.P_Kol_Tip_M Bed Where Bed.Koli_Kod=Asorti collate turkish_ci_as) as Asorti_Tanim2   , sum(isNull(Siparis_Miktari,0)) as Siparis_Miktari  , Sum(Toplam_Kapatilan) as Toplam_Kapatilan  , Sum(isnull(gonderilen,0)) as Gonderilen  , Sum(isnull(faturalanan,0)) as Faturalanan   , Sum((isnull(Toplam_Kapatilan,0)-isnull(gonderilen,0))) as Harici_Kapatilan  , (sum(Siparis_Miktari)-Sum(isnull(Toplam_Kapatilan,0))) as Net_Kalan  ,sum(isnull(Satinalma_Top,0)) as Satinalma_Top  ,sum(isnull(Satinalma_kalan,0)) as Satinalma_kalan  ,(select isnull(Sonuc,0) from  dbo.kg_ifn_GetStkAsortiMik2(ma.SKod  , ma.rkod  , ma.asorti, 'L001' ,null,'*','*' ,ma.LotNo)) as Stok_Mevcudu  ,(select isnull(Sonuc,0) from  dbo.kg_ifn_GetStkAsortiMik2(ma.SKod  , ma.rkod  , ma.asorti, 'L001' ,null,'g','*',ma.LotNo))  as Giren  ,(select isnull(Sonuc,0) from  dbo.kg_ifn_GetStkAsortiMik2(ma.SKod  , ma.rkod  , ma.asorti, 'L001' ,null,'c','*',ma.LotNo)) as Cikan   ,(select isnull(Sonuc,0) from  dbo.kg_ifn_GetStkAsortiMik2(ma.SKod  , ma.rkod  , ma.asorti, 'L001' ,null,'gi','*',ma.LotNo)) as Gireniade   ,(select isnull(Sonuc,0) from  dbo.kg_ifn_GetStkAsortiMik2(ma.SKod  , ma.rkod  , ma.asorti, 'L001' ,null,'ci','*',ma.LotNo)) as Cikaniade  , (select sum(isnull(Koli_Adet,0)) from korgun_parameter.dbo.P_Kol_Tip_D where Koli_Kod=Asorti) as Asorti_icMik  From #BE25E87FF65D4ADC9ACC490D65AA72B2 ma  cross apply (Select Sum(giren) as giren, Sum(cikan) as cikan, Sum(gireniade) as gireniade, Sum(cikaniade) as cikaniade, Sum(giren-cikan-gireniade+cikaniade) AS sonuc from ##515782B33D1D4967853760C27F48BD24 t where  ma.Skod=t.Skod and ma.RKod=t.RKod  and ma.Asorti=t.Asorti  ) as mev  Group By cariKod, CariKod_Tanim,SKod, SKod_Tanim,SipNo,BelgeNo,SipTanim,LotNo,RKod, RKod_Tanim,Asorti,mev.sonuc,mev.giren,mev.cikan,mev.gireniade,mev.cikaniade  Having  ((sum(isnull(Siparis_Miktari,0)) - Sum(isnull(Toplam_Kapatilan,0)) ) > 0)) asa; Select *  into ##89DEF59E861D45329A6874334CC8E7FF from ##A22D1ACC4A994FD79EFC867C466E03BB Select * from ##89DEF59E861D45329A6874334CC8E7FF;",00:14:23,2025-05-03 13:52:20,ira
